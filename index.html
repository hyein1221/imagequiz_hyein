<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ì´ë¯¸ì§€ í€´ì¦ˆ_hyein</title>
<style>
  :root{
    --gap: 0px;            /* ë¹ˆí‹ˆ ì—†ì´ ì‹œì‘ */
    --tile-opacity: 1;     /* ì™„ì „ ë¶ˆíˆ¬ëª… */
    --radius: 12px;
    --anim: 240ms;
    --bg: #0b1020;
    --fg: #eaf0ff;
    --accent: #38bdf8;
    --cover: #0f172a;      /* íƒ€ì¼(ë®ê°œ) ìƒ‰ */
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,"Noto Sans KR",Roboto,sans-serif;
    background: var(--bg); color: var(--fg);
    min-height:100svh; display:grid; grid-template-rows:1fr;
  }

  /* === 1P: ì„¸íŒ… í™”ë©´ === */
  #setup{
    max-width:1100px; margin:auto; width:clamp(320px, 92vw, 1100px);
    padding:24px; display:grid; gap:18px;
  }
  .panel{
    background:#101635; border:1px solid #1e264f; border-radius:16px; padding:16px;
  }
  .grid2{display:grid; grid-template-columns:1.2fr 1fr; gap:16px}
  .grid4{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
  .field{display:grid; gap:10px; min-width:0}
  label{font-size:18px; color:#c7d2fe}
  input[type="file"], input[type="number"], input[type="text"]{width:100%}
  input[type="number"], input[type="text"]{
    background:#121737; color:var(--fg); border:1px solid #2a3170;
    border-radius:10px; padding:10px 12px;
  }
  .btn{
    padding:15px 15px; border-radius:10px; border:2px solid #2a3170;
    background:#151b3a; color:var(--fg); font-weight:700; cursor:pointer;
  }
  .btn:hover{background:#111739}
  .btn.primary{background:var(--accent); border-color:#0ea5e9; color:#07131b}
  .hint{font-size:15px; color:#9aa4d6}
 h1{margin:4px 0 0; font-size:22px}

  /* ================================= */
  /* ğŸ‘‡ ì—¬ê¸°ì— ì½”ë“œë¥¼ ì¶”ê°€í•˜ì‹œë©´ ë©ë‹ˆë‹¤ ğŸ‘‡ */
  #start {
    font-size: 20px;
  }
  /* ================================= */

  /* === 2P: ê²Œì„ í™”ë©´ === */
  #game{display:none; place-items:center; padding:clamp(10px,3vw,24px)}
  .stage-wrap{
    width:min(1150px,95vw); aspect-ratio:16/9; position:relative;
    border:1px solid #1f2540; border-radius:var(--radius); overflow:hidden;
    background:#0e1433; box-shadow:0 10px 40px rgba(0,0,0,.35);
  }
  .stage-bg{position:absolute; inset:0; background:center/cover no-repeat #0e1433}
  .grid{
    position:absolute; inset:0; display:grid; gap:var(--gap); padding:0;
    background: transparent;   /* í•µì‹¬: ê·¸ë¦¬ë“œ ë°°ê²½ì€ íˆ¬ëª…! */
  }
  .tile{
    background:var(--cover); opacity:var(--tile-opacity); border:none; border-radius:0;
    transition:opacity var(--anim) ease; cursor:pointer;
  }
  .tile.revealed{opacity:0; pointer-events:none}

  .hud{
    position:absolute; inset:auto 10px 10px 10px; display:flex; gap:8px; flex-wrap:wrap;
    background:rgba(10,12,28,.56); border:1px solid rgba(255,255,255,.08);
    padding:8px; border-radius:12px; backdrop-filter: blur(6px);
  }
  .btn.small{padding:8px 10px; font-weight:600}

  .status{
    position:absolute; top:10px; right:10px; display:flex; gap:8px; flex-wrap:wrap
  }
  .chip{
    background:rgba(10,12,28,.58); border:1px solid rgba(255,255,255,.1);
    padding:6px 10px; border-radius:999px; font-size:12px; backdrop-filter: blur(6px);
  }

 .answer-badge{
  position:absolute; right:14px; bottom:14px;
  background:rgba(56,189,248,.18);
  border:1px solid rgba(56,189,248,.6);
  color:#e0f2fe;
  padding:22px 26px;            /* â†‘ íŒ¨ë”© ì—… */
  border-radius:14px;
  font-weight:800;
  backdrop-filter:blur(6px);
  display:none;
  font-size:64px;               /* âœ… 2ë°° */
  text-shadow:0 1px 0 #05121a;
  z-index: 5;                    /* ê²¹ì¹¨ ë°©ì§€ */
}

  .credit-bar{
  margin-top: 10px;
  align-self: center;           /* ê°€ìš´ë° ì •ë ¬ */
  background: rgba(10,12,28,.65);
  color: #c7d2fe;
  border: 1px solid rgba(255,255,255,.12);
  padding: 8px 12px;
  border-radius: 10px;
  font-size: 12px;
  backdrop-filter: blur(6px);
}
</style>
</head>
<body>

<!-- 1P: ì„¸íŒ… -->
<section id="setup">
  <h1>ì´ë¯¸ì§€ í€´ì¦ˆ_hyein</h1>

  <div class="panel grid2">
    <div class="field">
      <label>ì´ë¯¸ì§€ ì„ íƒ (ì—¬ëŸ¬ ì¥ ê°€ëŠ¥ / ë“œë˜ê·¸&ë“œë¡­ ê°€ëŠ¥)</label>
      <input id="files" type="file" accept="image/*" multiple />
      <div class="hint">ê¶Œì¥: ê°€ë¡œ ì´ë¯¸ì§€. ê°œì¸ì •ë³´/ì €ì‘ê¶Œì€ í•­ìƒ ìœ ì˜í•˜ì„¸ìš”.</div>
    </div>
    <div class="field">
      <label>ì •ë‹µ<br>(ì‰¼í‘œë¡œ êµ¬ë¶„ / ë¯¸ì‘ì„±ì‹œ íŒŒì¼ëª… ìë™ ì‚¬ìš©)</label>
      <input id="answersInput" type="text" placeholder="ì˜ˆ) ê°•ì•„ì§€, ê³ ì–‘ì´, ì‚¬ê³¼, ì—°í•„" />
    </div>
  </div>

  <div class="panel grid4">
    <div class="field"><label>í–‰(Row)</label><input id="rows" type="number" min="2" max="60" value="10"></div>
    <div class="field"><label>ì—´(Col)</label><input id="cols" type="number" min="2" max="60" value="10"></div>
    <div class="field"><label>ìë™ ê³µê°œ ê°„ê²©(ms)</label><input id="intervalMs" type="number" min="50" step="10" value="200"></div>
    <div class="field"><label>ë¼ìš´ë“œ íƒ€ì´ë¨¸(ì´ˆ)</label><input id="roundSec" type="number" min="5" step="1" value="30"></div>
    <div class="field"><label>íƒ€ì„ì•„ì›ƒ í›„ ìë™ë„˜ê¹€(ì´ˆ)</label><input id="autoNextSec" type="number" min="0" step="0.5" value="2"></div>
    <div class="field"><label>&nbsp;</label><button id="start" class="btn primary">í€´ì¦ˆ ì‹œì‘</button></div>
    <div class="field"><label>&nbsp;</label><button id="demo" class="btn">ìƒ˜í”Œ ì´ë¯¸ì§€ë¡œ ë¯¸ë¦¬ë³´ê¸°</button></div>
  </div>

  <div class="panel">
    <div class="hint">Tip) 10Ã—10, ìë™ê³µê°œ 200~400ms íƒ€ì´ë¨¸ 20~30ì´ˆë¡œ ë¨¼ì € í…ŒìŠ¤íŠ¸ í›„ ë‚œì´ë„ ì¡°ì ˆí•˜ì„¸ìš”. <br> ìë™ ê³µê°œ ê°„ê²©ì˜ ê²½ìš° ìˆ«ìê°€ ë‚®ì„ ìˆ˜ë¡ ë¹¨ë¦¬ ê³µê°œë©ë‹ˆë‹¤. <br> ë‹¨ì¶•í‚¤: ìŠ¤í˜ì´ìŠ¤(ì¼ì‹œì •ì§€/ë‹¤ì‹œ ì‹œì‘), A/D(ì´ì „/ë‹¤ìŒ)</div>
  </div>
 <div class="credit-bar">ì œì‘ì: ê¹€í˜œì¸ Â· ë¬¸ì˜: hyein_1221@hanmail.net</div>
</section>
</section>

<!-- 2P: ê²Œì„ -->
<section id="game">
  <div id="stage" class="stage-wrap" aria-live="polite">
    <div id="bg" class="stage-bg" role="img" aria-label="í€´ì¦ˆ ì´ë¯¸ì§€"></div>
    <div id="grid" class="grid" aria-label="ë®ê°œ ê²©ì"></div>

    <div class="hud">
      <button id="revealAll" class="btn small">ì „ì²´ ê³µê°œ</button>
      <button id="hideAll" class="btn small">ì „ì²´ ê°€ë¦¬ê¸°</button>
      <button id="pause" class="btn small">ì¼ì‹œì •ì§€</button>
      <button id="resume" class="btn small">ë‹¤ì‹œ ì‹œì‘</button>
      <button id="prev" class="btn small">ì´ì „</button>
      <button id="next" class="btn small">ë‹¤ìŒ</button>
      <button id="backToSetup" class="btn small">ì²˜ìŒìœ¼ë¡œ</button>
    </div>

    <div class="status">
      <div id="chipIdx" class="chip">ì´ë¯¸ì§€ 0/0</div>
      <div id="chipHidden" class="chip">ìˆ¨ê¹€: 0ì¹¸</div>
      <div id="chipTimer" class="chip">ë‚¨ì€ ì‹œê°„: 0s</div>
      <div id="chipAuto" class="chip">ìë™ê³µê°œ: êº¼ì§</div>
    </div>

 <div id="answerBadge" class="answer-badge">ì •ë‹µ: -</div>
  </div>

  <!-- âœ… ìŠ¤í…Œì´ì§€ ë°”ê¹¥(ì•„ë˜)ìœ¼ë¡œ ì´ë™ -->
  <div class="credit-bar">ì œì‘ì: ê¹€í˜œì¸ Â· ë¬¸ì˜: hyein_1221@hanmail.net</div>
</section>

<script>
/* ===== ê³µí†µ ì—˜ë¦¬ë¨¼íŠ¸ ===== */
const setup = document.getElementById('setup');
const game  = document.getElementById('game');

const filesInput    = document.getElementById('files');
const answersInput  = document.getElementById('answersInput');
const rowsInput     = document.getElementById('rows');
const colsInput     = document.getElementById('cols');
const intervalMsInput = document.getElementById('intervalMs');
const roundSecInput = document.getElementById('roundSec');
const autoNextSecInput = document.getElementById('autoNextSec');

const startBtn = document.getElementById('start');
const demoBtn  = document.getElementById('demo');
const prevBtn  = document.getElementById('prev');
const nextBtn  = document.getElementById('next');
const revealAllBtn = document.getElementById('revealAll');
const hideAllBtn   = document.getElementById('hideAll');
const pauseBtn     = document.getElementById('pause');
const resumeBtn    = document.getElementById('resume');
const backBtn      = document.getElementById('backToSetup');

const stage   = document.getElementById('stage');
const bgEl    = document.getElementById('bg');
const gridEl  = document.getElementById('grid');
const answerBadge = document.getElementById('answerBadge');

const chipIdx    = document.getElementById('chipIdx');
const chipHidden = document.getElementById('chipHidden');
const chipTimer  = document.getElementById('chipTimer');
const chipAuto   = document.getElementById('chipAuto');

/* ===== ìƒíƒœ ===== */
let images = [];      // dataURL ë°°ì—´
let filenames = [];   // í™•ì¥ì ì œê±° íŒŒì¼ëª…
let customAnswers = []; // ì‚¬ìš©ì ì…ë ¥ ì •ë‹µ(ì˜µì…˜)
let idx = 0;
let rows = +rowsInput.value, cols = +colsInput.value;

let autoRevealTimer = null;   // setInterval
let countdownTimer  = null;   // setInterval(1s)
let remain = 0;               // ë‚¨ì€ ì´ˆ
let autoMs = +intervalMsInput.value; // ìë™ê³µê°œ ê°„ê²©(ms)
let paused = false;
let nextTimeout = null;       // íƒ€ì„ì—… í›„ ìë™ë‹¤ìŒ setTimeout

/* ===== ìœ í‹¸ ===== */
function clamp(v, min, max){ return isFinite(v)? Math.max(min, Math.min(max, v)) : min; }
function baseName(name){ return name.replace(/\.[^/.]+$/,'').replace(/[_\-]+/g,' ').trim(); }
function updateChips(){
  const total = rows*cols;
  const revealed = gridEl.querySelectorAll('.tile.revealed').length;
  chipIdx.textContent = `ì´ë¯¸ì§€ ${images.length? (idx+1):0}/${images.length}`;
  chipHidden.textContent = `ìˆ¨ê¹€: ${total - revealed}ì¹¸`;
  chipTimer.textContent = `ë‚¨ì€ ì‹œê°„: ${remain}s`;
  chipAuto.textContent  = `ìë™ê³µê°œ: ${autoRevealTimer? (autoMs+'ms') : 'êº¼ì§'}`;
}
function setAspectToImage(dataURL){
  const img = new Image();
  img.onload = () => { stage.style.aspectRatio = `${img.width} / ${img.height}`; };
  img.src = dataURL;
}
function parseAnswersInput(){
  customAnswers = (answersInput.value || '')
    .split(',').map(s=>s.trim());
}

/* WebAudio ë¹„í”„ */
let audioCtx = null;
function beep(freq=880, dur=0.15, vol=0.2){
  if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const o = audioCtx.createOscillator(); const g = audioCtx.createGain();
  o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
  o.connect(g); g.connect(audioCtx.destination); o.start();
  setTimeout(()=>o.stop(), dur*1000);
}

/* ===== ì„¸íŒ… ì´ë²¤íŠ¸ ===== */
answersInput.addEventListener('change', parseAnswersInput);

filesInput.addEventListener('change', async (e)=>{
  const files = [...e.target.files].filter(f=>f.type.startsWith('image/'));
  images = []; filenames = [];
  for (const f of files){
    images.push(await fileToDataURL(f));
    filenames.push(baseName(f.name));
  }
});

demoBtn.addEventListener('click', async ()=>{
  // ì˜¤í”„ë¼ì¸ ìƒ˜í”Œ 3ì¥
  const makeSolid = (w,h,color,text)=> {
    const c=document.createElement('canvas'); c.width=w; c.height=h;
    const x=c.getContext('2d'); x.fillStyle=color; x.fillRect(0,0,w,h);
    x.fillStyle='#fff'; x.font='bold 96px system-ui'; x.textAlign='center'; x.textBaseline='middle';
    x.fillText(text,w/2,h/2);
    return c.toDataURL('image/png');
  };
  images=[makeSolid(1280,720,'#ef4444','ì‚¬ê³¼'), makeSolid(1280,720,'#22c55e','ë‚˜ë¬´'), makeSolid(1280,720,'#3b82f6','ë°”ë‹¤')];
  filenames=['ì‚¬ê³¼','ë‚˜ë¬´','ë°”ë‹¤'];
  answersInput.value='ì‚¬ê³¼, ë‚˜ë¬´, ë°”ë‹¤';
  parseAnswersInput();
  alert('ìƒ˜í”Œ ì´ë¯¸ì§€ 3ì¥ì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
});

startBtn.addEventListener('click', ()=>{
  if(!images.length){ alert('ì´ë¯¸ì§€ë¥¼ ë¨¼ì € ì„ íƒí•´ ì£¼ì„¸ìš”.'); return; }
  parseAnswersInput();
  setup.style.display='none';
  game.style.display='grid';
  idx=0;
  setupRound();
});
backBtn.addEventListener('click', ()=>{
  stopEverything();
  game.style.display='none';
  setup.style.display='grid';
});

function fileToDataURL(file){
  return new Promise((res)=>{ const r=new FileReader(); r.onload=e=>res(e.target.result); r.readAsDataURL(file); });
}

/* ===== ê²Œì„ ì»¨íŠ¸ë¡¤ ===== */
prevBtn.addEventListener('click', ()=>{ if(!images.length) return; idx=(idx-1+images.length)%images.length; setupRound(); });
nextBtn.addEventListener('click', ()=>{ if(!images.length) return; idx=(idx+1)%images.length; setupRound(); });

revealAllBtn.addEventListener('click', ()=>{ revealAll(); showAnswer(); });
hideAllBtn.addEventListener('click', ()=>{ hideAll(); });
pauseBtn.addEventListener('click', ()=>{ paused=true; stopAutoReveal(); stopCountdown(); clearNextTimeout(); });
resumeBtn.addEventListener('click', ()=>{ paused=false; startAutoReveal(); startCountdown(); });

rowsInput.addEventListener('change', ()=>{ if(game.style.display!=='none'){ rows=clamp(+rowsInput.value,2,60); buildGrid(); startAutoReveal(); }});
colsInput.addEventListener('change', ()=>{ if(game.style.display!=='none'){ cols=clamp(+colsInput.value,2,60); buildGrid(); startAutoReveal(); }});
intervalMsInput.addEventListener('change', ()=>{ autoMs=Math.max(50,+intervalMsInput.value||200); if(game.style.display!=='none') startAutoReveal(); updateChips(); });
roundSecInput.addEventListener('change', ()=>{ remain = Math.max(5,+roundSecInput.value||30); updateChips(); });

/* ===== ë¼ìš´ë“œ ì„¸íŒ… ===== */
function setupRound(){
  clearNextTimeout();
  answerBadge.style.display='none'; // ì‹œì‘ ì‹œ ì •ë‹µ ìˆ¨ê¹€

  const url = images[idx];
  bgEl.style.backgroundImage = `url('${url}')`;
  setAspectToImage(url);

  rows = clamp(+rowsInput.value,2,60);
  cols = clamp(+colsInput.value,2,60);
  buildGrid();

  autoMs = Math.max(50, +intervalMsInput.value||200);
  remain  = Math.max(5, +roundSecInput.value||30);

  startAutoReveal();
  startCountdown();
  updateChips();
}
function stopEverything(){
  stopAutoReveal(); stopCountdown(); clearNextTimeout();
}

/* ===== ê²©ì/íƒ€ì¼ ===== */
function buildGrid(){
  stopAutoReveal();
  gridEl.innerHTML='';
  gridEl.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
  gridEl.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
  const total = rows*cols;
  for(let i=0;i<total;i++){
    const b=document.createElement('button');
    b.className='tile'; b.type='button';
    b.addEventListener('click', ()=>revealTile(b));
    gridEl.appendChild(b);
  }
  updateChips();
}
function revealTile(t){
  if(!t.classList.contains('revealed')){
    t.classList.add('revealed'); updateChips();
    if(gridEl.querySelectorAll('.tile:not(.revealed)').length===0){
      stopAutoReveal(); stopCountdown(); showAnswer(); scheduleAutoNext();
    }
  }
}
function revealRandomTile(){
  const hidden=[...gridEl.querySelectorAll('.tile:not(.revealed)')];
  if(!hidden.length) return;
  const pick=hidden[Math.floor(Math.random()*hidden.length)];
  revealTile(pick);
}
function revealAll(){ gridEl.querySelectorAll('.tile').forEach(t=>t.classList.add('revealed')); updateChips(); stopAutoReveal(); stopCountdown(); showAnswer(); }
function hideAll(){ gridEl.querySelectorAll('.tile').forEach(t=>t.classList.remove('revealed')); updateChips(); answerBadge.style.display='none'; }

/* ===== ìë™ ê³µê°œ & íƒ€ì´ë¨¸ ===== */
function startAutoReveal(){
  stopAutoReveal();
  autoRevealTimer = setInterval(()=>{ if(!paused) revealRandomTile(); }, autoMs);
  updateChips();
}
function stopAutoReveal(){ if(autoRevealTimer){ clearInterval(autoRevealTimer); autoRevealTimer=null; updateChips(); } }

function startCountdown(){
  stopCountdown();
  chipTimer.textContent = `ë‚¨ì€ ì‹œê°„: ${remain}s`;
  countdownTimer = setInterval(()=>{
    if(paused) return;
    remain -= 1;
    chipTimer.textContent = `ë‚¨ì€ ì‹œê°„: ${remain}s`;
    if(remain<=10 && remain>0) beep(900,0.12,0.25);     // 10ì´ˆ ê²½ê³ ìŒ
    if(remain<=0){
      beep(500,0.25,0.35); beep(300,0.25,0.35);
      revealAll(); // ë‚´ë¶€ì—ì„œ showAnswer í˜¸ì¶œë¨
      stopCountdown(); scheduleAutoNext();
    }
  },1000);
}
function stopCountdown(){ if(countdownTimer){ clearInterval(countdownTimer); countdownTimer=null; } }

/* ===== ì •ë‹µ ===== */
function currentAnswer(){
  const user = (customAnswers[idx]||'').trim();
  if(user) return user;
  return filenames[idx] || '-';
}
function showAnswer(){
  answerBadge.textContent = 'ì •ë‹µ: ' + currentAnswer();
  answerBadge.style.display = 'block';
}

/* ===== íƒ€ì„ì—… í›„ ìë™ë‹¤ìŒ ===== */
function scheduleAutoNext(){
  const delaySec = Math.max(0, +autoNextSecInput.value||0);
  if(!images.length || delaySec===0) return;
  clearNextTimeout();
  nextTimeout = setTimeout(()=>{ idx = (idx + 1) % images.length; setupRound(); }, delaySec*1000);
}
function clearNextTimeout(){ if(nextTimeout){ clearTimeout(nextTimeout); nextTimeout=null; } }

/* ë‹¨ì¶•í‚¤: ìŠ¤í˜ì´ìŠ¤(ì¼ì‹œì •ì§€/ì¬ê°œ), d/a(ë‹¤ìŒ/ì´ì „) */
window.addEventListener('keydown',(e)=>{
  if(game.style.display==='none') return;
  const k=e.key.toLowerCase();
  if(k===' '){ e.preventDefault(); paused ? (paused=false, startAutoReveal(), startCountdown()) : (paused=true, stopAutoReveal(), stopCountdown(), clearNextTimeout()); }
  if(k==='d'){ nextBtn.click(); }
  if(k==='a'){ prevBtn.click(); }
});
</script>
</body>
</html>






